<link rel="import" href="../polymer/polymer.html">

<!--
## The (Unofficial) CanIUse Embed

`<caniuse-embed>` is a Polymer Element that displays feature support data from caniuse for multiple versions of the 10 major browsers. Configurable, reliable, and fully responsive. Based on this [original JavaScript embed](https://caniuse.bitsofco.de/).

For example, the following element will generate an embed for the feature, "SVG Effects for HTML"

    <caniuse-embed feature="svg-html" futureVersions="1" pastVersions="2"></caniuse-embed>

<img src="https://github.com/ireade/caniuse-embed/raw/gh-pages/example.png" alt="" style="width: 100%">

-->

<dom-module id="caniuse-embed">

  <template>
    <style>
      :host {
        display: block;
        width: 100%;
      }
    </style>

    <iframe src="//caniuse.bitsofco.de/embed/index.html?feat=[[feature]]&periods=[[periods]]"
            frameborder="0"
            width="100%"
            height="400px"></iframe>
  </template>

  <script>
  Polymer({
    is: 'caniuse-embed',
    properties: {
      /* The feature slug from caniuse.com */
      feature: String,

      /* The number of future browser versions to display (optional) */
      futureVersions: String,

      /* The number of previous browser versions to display (optional) */
      pastVersions: String,

      /* An internally used property (don't specify) */
      periods: String
    },
    ready: function() {

      if ( !this.feature ) this.textContent = `A feature was not included. Go to <a href='http://caniuse.bitsofco.de/#how-to-use'>http://caniuse.bitsofco.de/#how-to-use</a> to generate an embed.`;

      let future = '';
      if ( this.futureVersions ) {
        for (let i = 1; i < parseInt(this.futureVersions) + 1; i++) {
          future += `future_${i},`
        }
      }

      let past = '';
      if ( this.pastVersions ) {
        for (let i = 1; i < parseInt(this.pastVersions) + 1; i++) {
          past += `,past_${i}`
        }
      }

      this.periods = future + 'current' + past;
    }
  });


  // Handle Sizing of iFrame
  const eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
	const eventer = window[eventMethod];
	const messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
	eventer(messageEvent, function(e) {
		const data = e.data;
		if (  (typeof data === 'string') && (data.indexOf('ciu_embed') > -1) ) {
		 	const featureID = data.split(':')[1];
		 	const height = parseInt( data.split(':')[2] ) + 30;
      const iframe = document.querySelector('iframe');
      iframe.height = height + 'px';
		}
	},false);

  </script>

</dom-module>
